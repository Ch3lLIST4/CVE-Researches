// demo 1 - thay doi logic ung dung - nang quyen
// - thay doi gia tri object qua intercept
// - ung dung thuc hien merge 2 object tai back-end su dung thu vien merge-deep
// - object truyen vao chua thuoc tinh "constructor.prototype.isAdmin" dc set gia tri la "true"
// - toan bo cac JS object duoc gan gia tri la "true" cho thuoc tinh ten "isAdmin"


// npm install --save merge-deep
const merge = require('merge-deep');

// npm install --save express
const express = require('express');


// used to parse HTTP post request body
var bodyParser = require('body-parser');

var app = express();

// create application/json parser
var jsonParser = bodyParser.json();
 
// create application/x-www-form-urlencoded parser
var urlencodedParser = bodyParser.urlencoded({ extended: false });


INDEX_PATH = '/';
MERGE_PATH = '/merge';
ADMIN_PATH = '/admin';
TEMP_USER = {};


app.get(INDEX_PATH, function(req, res){
    res.sendFile('./static/index.html', {root: __dirname });
});

app.post(MERGE_PATH, jsonParser, function(req, res){
    
    let source = req.body; 
    let target = {ip:req.socket.remoteAddress};

    result = merge(target, source);
    res.send(result);

});

app.get(ADMIN_PATH, function(req, res){

    function checkLogin() {
        // do some credentials checking
        return false;
    }
    if (checkLogin()) {
        TEMP_USER.isAdmin = true;
    }

    if (TEMP_USER.isAdmin === true) {
        res.send('<h1>WELCOME ADMIN!</h1>')
    } else {
        res.send('<h2>ONLY ADMIN CAN VIEW THIS PAGE!</h1>')
    }

});


app.listen(3000);